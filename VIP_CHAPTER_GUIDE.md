# VIP Access Per Chapter - Implementation Guide

## üìã –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. ‚úÖ Frontend (Admin UI)
- **–ú–æ–¥–∞–ª–∫–∞ "–°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤—É"**: –¥–æ–±–∞–≤–ª–µ–Ω—ã VIP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  - üîí Checkbox "–¢–æ–ª—å–∫–æ –¥–ª—è VIP"
  - ‚è∞ Input "–†–∞–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–ª—è VIP (–¥–Ω—ñ–≤)"
  
- **–ú–æ–¥–∞–ª–∫–∞ "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≥–ª–∞–≤—É"**: —Ç–µ –∂–µ VIP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤
  - "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å"
  - "–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é"

- **–°–ø–∏—Å–æ–∫ –≥–ª–∞–≤**: –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã VIP —Å—Ç–∞—Ç—É—Å–∞
  - üîí VIP Only badge (purple) - –µ—Å–ª–∏ `vip_only: true`
  - ‚è∞ VIP +X–¥ badge (indigo) - –µ—Å–ª–∏ `vip_early_days > 0`

### 2. ‚úÖ Backend (API)
- **POST `/api/admin/manhwa/{id}/chapters`**: —Å–æ–∑–¥–∞–Ω–∏–µ –≥–ª–∞–≤—ã —Å VIP –ø–æ–ª—è–º–∏
- **PUT `/api/admin/chapters/{id}/publish`**: –ø—É–±–ª–∏–∫–∞—Ü–∏—è/–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å VIP –ø–æ–ª—è–º–∏

### 3. ‚úÖ Database Migration
- –§–∞–π–ª: `migrations/add_vip_fields_to_chapters.sql`
- –î–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫–∏:
  - `vip_only BOOLEAN DEFAULT false`
  - `vip_early_days INTEGER DEFAULT 0`
- –°–æ–∑–¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö VIP-–∑–∞–ø—Ä–æ—Å–æ–≤
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≥–ª–∞–≤—ã –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

## üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Supabase Dashboard
1. –û—Ç–∫—Ä—ã—Ç—å Supabase Dashboard ‚Üí SQL Editor
2. –í—Å—Ç–∞–≤–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `migrations/add_vip_fields_to_chapters.sql`
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å (Run)

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ psql CLI
```bash
psql -h db.YOUR_PROJECT.supabase.co -U postgres -d postgres -f migrations/add_vip_fields_to_chapters.sql
```

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ß–µ—Ä–µ–∑ Supabase CLI
```bash
supabase db push
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
SELECT column_name, data_type, column_default 
FROM information_schema.columns 
WHERE table_name = 'chapters' 
AND column_name IN ('vip_only', 'vip_early_days');

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å
SELECT indexname FROM pg_indexes WHERE tablename = 'chapters';
```

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≥–ª–∞–≤—É —Å VIP –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏**
   - –ü–µ—Ä–µ–π—Ç–∏ –≤ `/admin`
   - –û—Ç–∫—Ä—ã—Ç—å –ª—é–±—É—é –º–∞–Ω—Ö–≤—É
   - –ù–∞–∂–∞—Ç—å "‚ûï –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ä–æ–∑–¥—ñ–ª"
   - –í–∫–ª—é—á–∏—Ç—å "üîí –¢—ñ–ª—å–∫–∏ –¥–ª—è VIP" –∏–ª–∏ –∑–∞–¥–∞—Ç—å "‚è∞ –†–∞–Ω–Ω—ñ–π –¥–æ—Å—Ç—É–ø"
   - –°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤—É

2. **–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≥–ª–∞–≤—É —Å VIP –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏**
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –≥–ª–∞–≤—É
   - –ù–∞–∂–∞—Ç—å "‚è∞ –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è"
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å VIP –¥–æ—Å—Ç—É–ø:
     - –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å + VIP Early 7 –¥–Ω–µ–π
     - –ò–õ–ò –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å + VIP Only
   - –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**
   - –í —Å–ø–∏—Å–∫–µ –≥–ª–∞–≤ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è badges:
     - üîí VIP Only (purple) - –¥–ª—è vip_only –≥–ª–∞–≤
     - ‚è∞ VIP +X–¥ (indigo) - –¥–ª—è vip_early_days –≥–ª–∞–≤

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î**
```sql
SELECT chapter_number, title, vip_only, vip_early_days, status
FROM chapters
WHERE manhwa_id = 'your-manhwa-id'
ORDER BY chapter_number DESC;
```

## üìù –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª–Ω–æ—Å—Ç—å—é VIP-—ç–∫—Å–∫–ª—é–∑–∏–≤
```
–°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤—É ‚Üí vip_only: true, vip_early_days: 0
–†–µ–∑—É–ª—å—Ç–∞—Ç: —Ç–æ–ª—å–∫–æ VIP –∏ –∞–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç –≥–ª–∞–≤—É, –æ–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ù–ï –í–ò–î–Ø–¢ –≤–æ–æ–±—â–µ
```

#### –ü—Ä–∏–º–µ—Ä 2: –†–∞–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø –Ω–∞ 7 –¥–Ω–µ–π
```
–°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤—É ‚Üí vip_only: false, vip_early_days: 7
–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å (published_at: 2026-01-11)
–†–µ–∑—É–ª—å—Ç–∞—Ç:
- VIP –≤–∏–¥—è—Ç —Å 2026-01-11
- –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Å 2026-01-18
```

#### –ü—Ä–∏–º–µ—Ä 3: –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è + —Ä–∞–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø
```
–°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤—É ‚Üí vip_early_days: 3
–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å: –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 2026-01-15 12:00
–†–µ–∑—É–ª—å—Ç–∞—Ç:
- VIP –≤–∏–¥—è—Ç —Å 2026-01-15 12:00
- –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Å 2026-01-18 12:00
```

#### –ü—Ä–∏–º–µ—Ä 4: –î–ª—è –≤—Å–µ—Ö —Å—Ä–∞–∑—É
```
–°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤—É ‚Üí vip_only: false, vip_early_days: 0
–†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –≥–ª–∞–≤—É –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
```

## üîç Next Steps (—á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª–µ–µ)

### 1. –õ–æ–≥–∏–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ frontend
–û–±–Ω–æ–≤–∏—Ç—å `/app/manhwa/[id]/page.tsx` –∏ `/app/reader/[id]/[chapterId]/page.tsx`:
- –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –≥–ª–∞–≤—ã –ø–æ `vip_only` –∏ `vip_early_days`
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å "üîí VIP" badge –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–ª–∞–≤
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`user`, `vip`, `admin`)

### 2. API –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –≥–ª–∞–≤
–û–±–Ω–æ–≤–∏—Ç—å `/app/api/public/manhwa/[id]/route.ts`:
```typescript
// –õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≥–ª–∞–≤ –ø–æ VIP —Å—Ç–∞—Ç—É—Å—É
const chapters = await supabase
  .from('chapters')
  .select('*')
  .eq('manhwa_id', id)
  .eq('status', 'published')
  .then(({ data }) => {
    return data?.filter(chapter => {
      // –ï—Å–ª–∏ vip_only - –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ VIP/admin
      if (chapter.vip_only && userRole !== 'vip' && userRole !== 'admin') {
        return false;
      }
      
      // –ï—Å–ª–∏ vip_early_days - –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞—Ç—É
      if (chapter.vip_early_days > 0 && userRole !== 'vip' && userRole !== 'admin') {
        const publishedDate = new Date(chapter.published_at);
        const availableForRegular = new Date(publishedDate.getTime() + chapter.vip_early_days * 24 * 60 * 60 * 1000);
        if (new Date() < availableForRegular) {
          return false; // –ï—â–µ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        }
      }
      
      return true;
    });
  });
```

### 3. –¢–µ—Å—Ç—ã
–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ VIP –ª–æ–≥–∏–∫–∏:
- `__tests__/vip-chapter-access.test.ts`
- –¢–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö 4 –ø—Ä–∏–º–µ—Ä–æ–≤ –≤—ã—à–µ

## üìö –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª–µ–π

### Table: `chapters`
| Column | Type | Default | Description |
|--------|------|---------|-------------|
| `vip_only` | BOOLEAN | false | –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ VIP/admin |
| `vip_early_days` | INTEGER | 0 | –î–Ω–∏ —Ä–∞–Ω–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è VIP |

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
1. –ï—Å–ª–∏ `vip_only: true` ‚Üí —Ç–æ–ª—å–∫–æ VIP –∏ admin
2. –ò–Ω–∞—á–µ –µ—Å–ª–∏ `vip_early_days > 0` ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞—Ç—É –¥–æ—Å—Ç—É–ø–∞
3. –ò–Ω–∞—á–µ ‚Üí –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º

## ‚ö†Ô∏è –í–∞–∂–Ω–æ
- **vip_only –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –µ—Å–ª–∏ true, —Ç–æ vip_early_days –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
- **–ê–¥–º–∏–Ω—ã –≤—Å–µ–≥–¥–∞ –≤–∏–¥—è—Ç –≤—Å–µ –≥–ª–∞–≤—ã** –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç VIP –Ω–∞—Å—Ç—Ä–æ–µ–∫
- **Scheduled –≥–ª–∞–≤—ã –Ω–µ –ø—É–±–ª–∏—á–Ω—ã** –¥–æ –º–æ–º–µ–Ω—Ç–∞ published_at, –¥–∞–∂–µ –¥–ª—è VIP
