# VIP System - README

## üìñ Overview

VIP —Å–∏—Å—Ç–µ–º–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
1. **–†–æ–ª—å VIP** - –Ω–æ–≤–∞—è —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–µ–∂–¥—É `user` –∏ `admin`
2. **VIP-only –∫–æ–Ω—Ç–µ–Ω—Ç** - —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è VIP –∏ –∞–¥–º–∏–Ω–æ–≤
3. **–†–∞–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø** - VIP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Å—Ç—É–ø –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏—è–º —Ä–∞–Ω—å—à–µ

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- –ü–æ–º–µ—Ç–∫–∞ —Ç–∞–π—Ç–ª–æ–≤ –∫–∞–∫ VIP-only
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–Ω–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (–≤ –¥–Ω—è—Ö)
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö —Ä–æ–ª–µ–π

### –î–ª—è VIP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –î–æ—Å—Ç—É–ø –∫ VIP-only –∫–æ–Ω—Ç–µ–Ω—Ç—É
- –†–∞–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø –∫ –Ω–æ–≤—ã–º –ø—É–±–ª–∏–∫–∞—Ü–∏—è–º
- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –±–µ–π–¥–∂–∏ –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–µ

### –î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –í–∏–¥–∏–º–æ—Å—Ç—å —Ç–æ–≥–æ, —á—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç VIP (—Å –∏–∫–æ–Ω–∫–æ–π –∑–∞–º–∫–∞)
- –ú–æ—Ç–∏–≤–∞—Ü–∏—è —Å—Ç–∞—Ç—å VIP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### –ú–∏–≥—Ä–∞—Ü–∏–∏
- `features/auth/migrations/005_add_vip_role_and_content_access.sql` - SQL –º–∏–≥—Ä–∞—Ü–∏—è

### Backend API
- `app/api/admin/users/route.ts` - –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `app/api/admin/users/[id]/role/route.ts` - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–∏
- `app/api/admin/manhwa/route.ts` - –°–æ–∑–¥–∞–Ω–∏–µ/—Å–ø–∏—Å–æ–∫ –º–∞–Ω—Ö–≤ (–æ–±–Ω–æ–≤–ª–µ–Ω)

### –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏
- `lib/auth.ts` - –£—Ç–∏–ª–∏—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `lib/admin.ts` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω)

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `components/admin/UserManagement.tsx` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `components/admin/AddManhwaModal.tsx` - –ú–æ–¥–∞–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞–Ω—Ö–≤—ã (–æ–±–Ω–æ–≤–ª–µ–Ω–∞)
- `components/VipBadge.tsx` - –ë–µ–π–¥–∂–∏ VIP-—Å—Ç–∞—Ç—É—Å–∞

### –•—É–∫–∏
- `hooks/useUserProfile.ts` - –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±–Ω–æ–≤–ª–µ–Ω)

### –°—Ç—Ä–∞–Ω–∏—Ü—ã
- `app/admin/page.tsx` - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–æ–±–Ω–æ–≤–ª–µ–Ω–∞)

### –¢–µ—Å—Ç—ã
- `__tests__/vip-system.test.ts` - –¢–µ—Å—Ç—ã VIP —Å–∏—Å—Ç–µ–º—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `docs/VIP_DEPLOYMENT_GUIDE.md` - –ì–∞–π–¥ –ø–æ –¥–µ–ø–ª–æ—é

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

```bash
psql -h <host> -U <user> -d <database> -f features/auth/migrations/005_add_vip_role_and_content_access.sql
```

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
npm run build
npm run start
```

### 3. –ù–∞–∑–Ω–∞—á–∏—Ç—å –ø–µ—Ä–≤–æ–≥–æ VIP

–ß–µ—Ä–µ–∑ SQL:
```sql
UPDATE users SET role = 'vip' WHERE email = 'user@example.com';
```

–ò–ª–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:
1. –í–æ–π—Ç–∏ –∫–∞–∫ admin
2. –û—Ç–∫—Ä—ã—Ç—å `/admin`
3. –í–∫–ª–∞–¥–∫–∞ "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ"
4. –í—ã–±—Ä–∞—Ç—å VIP –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ VIP-only —Ç–∞–π—Ç–ª–∞

1. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí –ù–æ–≤–∞ –º–∞–Ω—Ö–≤–∞
2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
3. –í–∫–ª—é—á–∏—Ç—å "üîí –¢—ñ–ª—å–∫–∏ –¥–ª—è VIP"
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–Ω–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞

1. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí –ù–æ–≤–∞ –º–∞–Ω—Ö–≤–∞
2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å "‚è∞ –†–∞–Ω–Ω—ñ–π –¥–æ—Å—Ç—É–ø –¥–ª—è VIP" = 3 (–¥–Ω—è)
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
5. VIP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–≤–∏–¥—è—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ 3 –¥–Ω—è —Ä–∞–Ω—å—à–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ VipBadge

```tsx
import { VipBadge } from '@/components/VipBadge';

<VipBadge 
  vipOnly={manhwa.vip_only}
  vipEarlyDays={manhwa.vip_early_days}
  userRole={profile?.role}
  publishedAt={manhwa.published_at}
/>
```

### –ó–∞—â–∏—Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

```tsx
import { VipContentBlock } from '@/components/VipBadge';

<VipContentBlock vipOnly={manhwa.vip_only} userRole={profile?.role}>
  <ManhwaChapters chapters={chapters} />
</VipContentBlock>
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–í–ê–ñ–ù–û:** –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –î–û–õ–ñ–ù–´ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!

### –ü—Ä–∞–≤–∏–ª—å–Ω–æ ‚úÖ

```typescript
// Server-side (API route)
const { data: manhwa } = await supabase
  .from('manhwa')
  .select('*')
  .eq('id', id)
  .single();

const userRole = await getUserRole(userId);

if (manhwa.vip_only && userRole !== 'vip' && userRole !== 'admin') {
  return NextResponse.json({ error: 'Access denied' }, { status: 403 });
}
```

### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚ùå

```typescript
// Client-side only
if (manhwa.vip_only && !isVip) {
  return <div>Access denied</div>;
}
// –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –æ–±–æ–π—Ç–∏ —ç—Ç—É –ø—Ä–æ–≤–µ—Ä–∫—É!
```

## üé® –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–ª–µ–¥—É—é—Ç –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–µ —Å–∞–π—Ç–∞:

- **–¶–≤–µ—Ç–∞ VIP**: –∂–µ–ª—Ç—ã–π (`yellow-500`)
- **–¶–≤–µ—Ç–∞ locked**: –∫—Ä–∞—Å–Ω—ã–π (`red-500`)
- **–¶–≤–µ—Ç–∞ early access**: —Å–∏–Ω–∏–π (`blue-500`)
- **–§–æ–Ω**: `bg-card-bg`, `bg-bg-main`
- **–¢–µ–∫—Å—Ç**: `text-text-main`, `text-text-muted`
- **–ì—Ä–∞–Ω–∏—Ü—ã**: `border-text-muted/20`

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ `manhwa`

| –ü–æ–ª–µ | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|--------------|----------|
| `vip_only` | boolean | false | –¢–æ–ª—å–∫–æ –¥–ª—è VIP |
| `vip_early_days` | integer | 0 | –î–Ω–µ–π —Ä–∞–Ω–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ |

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ `chapters`

| –ü–æ–ª–µ | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|--------------|----------|
| `vip_only` | boolean | false | –¢–æ–ª—å–∫–æ –¥–ª—è VIP |
| `vip_early_days` | integer | 0 | –î–Ω–µ–π —Ä–∞–Ω–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ |

### –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `role_change_audit`

–õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `can_user_access_vip_content`

PostgreSQL —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞:

```sql
SELECT can_user_access_vip_content(
  'user-id',
  true,  -- vip_only
  3,     -- vip_early_days
  '2026-01-15T00:00:00Z'  -- published_at
);
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
npm test vip-system.test.ts
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–º. —á–µ–∫–ª–∏—Å—Ç –≤ `__tests__/vip-system.test.ts` (—ç–∫—Å–ø–æ—Ä—Ç `QA_CHECKLIST`)

## üîÑ –û—Ç–∫–∞—Ç

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```sql
DROP FUNCTION IF EXISTS can_user_access_vip_content;
DROP TABLE IF EXISTS role_change_audit CASCADE;
DROP VIEW IF EXISTS admin_manhwa CASCADE;
ALTER TABLE chapters DROP COLUMN IF EXISTS vip_only, DROP COLUMN IF EXISTS vip_early_days;
ALTER TABLE manhwa DROP COLUMN IF EXISTS vip_only, DROP COLUMN IF EXISTS vip_early_days;
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `npm run dev` –∏–ª–∏ `pm2 logs`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ –ë–î
3. –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+R)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

## üéì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [VIP_DEPLOYMENT_GUIDE.md](docs/VIP_DEPLOYMENT_GUIDE.md) - –ü–æ–ª–Ω—ã–π –≥–∞–π–¥ –ø–æ –¥–µ–ø–ª–æ—é
- [vip-system.test.ts](__tests__/vip-system.test.ts) - –¢–µ—Å—Ç—ã –∏ QA —á–µ–∫–ª–∏—Å—Ç
- [005_add_vip_role_and_content_access.sql](features/auth/migrations/005_add_vip_role_and_content_access.sql) - SQL –º–∏–≥—Ä–∞—Ü–∏—è

## üìù Changelog

### Version 1.0.0 (2026-01-11)
- ‚ú® –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–æ–ª—å VIP
- ‚ú® VIP-only –∫–æ–Ω—Ç–µ–Ω—Ç
- ‚ú® –†–∞–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–ª—è VIP
- ‚ú® –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –≤ –∞–¥–º–∏–Ω–∫–µ
- ‚ú® VIP –±–µ–π–¥–∂–∏ –∏ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚ú® SQL –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚ú® –¢–µ—Å—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

**–ê–≤—Ç–æ—Ä:** Development Team  
**–î–∞—Ç–∞:** 11 —è–Ω–≤–∞—Ä—è 2026  
**–í–µ—Ä—Å–∏—è:** 1.0.0
